## âœ… SISTEMA COMPLETO - PRONTO PARA USO

### ğŸ“Š SITUAÃ‡ÃƒO ATUAL

**Encontrados no banco:** 29 usuÃ¡rios com assinatura expirada (de 2 a 8 dias atrÃ¡s)
**Status:** Todos ainda marcados como "active" (BUG confirmado)
**Pagamentos pendentes:** 0 (todos podem ser removidos)

---

## ğŸ¯ AÃ‡Ã•ES NECESSÃRIAS (EM ORDEM)

### 1ï¸âƒ£ CONFIGURAR VARIÃVEIS NA VERCEL

Acesse: Settings â†’ Environment Variables

Adicione (se ainda nÃ£o existirem):
```
CRON_SECRET = [gerar senha forte 32+ caracteres]
ADMIN_SECRET = [gerar senha forte diferente]
```

**Gerar secrets:**
```powershell
# Executar 2x para gerar 2 secrets diferentes
[Convert]::ToBase64String((1..32 | ForEach-Object { Get-Random -Maximum 256 }))
```

âœ… Salve e faÃ§a **REDEPLOY**

---

### 2ï¸âƒ£ LIMPAR USUÃRIOS ACUMULADOS (EXECUTAR APENAS 1 VEZ)

```bash
curl -X POST https://seu-projeto.vercel.app/api/jobs/cleanup-expired \
  -H "x-admin-secret: SEU_ADMIN_SECRET"
```

**O que vai fazer:**
- Remove os 29 usuÃ¡rios do grupo Telegram
- Marca como expirado no banco
- Envia QR Code de renovaÃ§Ã£o para cada um
- Envia link do grupo junto

**Tempo estimado:** 2-5 minutos

---

### 3ï¸âƒ£ CONFIGURAR CRON JOB (AUTOMAÃ‡ÃƒO PERMANENTE)

Acesse: https://cron-job.org/en/signup/

Configure:
```
TÃ­tulo: Expire Group Members
URL: https://seu-projeto.vercel.app/api/jobs/expire-members
MÃ©todo: POST
Schedule: Every 30 minutes
Headers: x-cron-secret: SEU_CRON_SECRET
```

---

## ğŸ”„ FUNCIONAMENTO AUTOMÃTICO (APÃ“S CONFIGURAR)

### â° A CADA 30 MINUTOS, O SISTEMA:

#### **3 DIAS ANTES DO VENCIMENTO:**
- ğŸ“§ Envia lembrete
- ğŸ’³ Gera QR Code PIX (vÃ¡lido 7 dias)
- ğŸ”— Envia link do grupo
- â° Avisa quantos dias restam

#### **NO DIA DO VENCIMENTO:**
- ğŸš¨ Envia lembrete URGENTE
- ğŸ’³ QR Code PIX
- ğŸ”— Link do grupo
- â° "EXPIRA EM X HORAS"

#### **SE O USUÃRIO PAGAR:**
- âœ… Admin aprova comprovante
- ğŸ“… Sistema estende +30 dias automaticamente
- âœ… MantÃ©m no grupo
- ğŸ”— Reenvia link de acesso

#### **SE NÃƒO PAGAR (APÃ“S 1 DIA VENCIDO):**
- âŒ Remove do grupo Telegram
- ğŸ’¾ Marca como expirado no banco
- ğŸ’³ Envia QR Code de renovaÃ§Ã£o
- ğŸ”— Envia link para voltar apÃ³s pagar

---

## âœ… VALIDAÃ‡ÃƒO FINAL

### ApÃ³s limpeza inicial:
```sql
-- Executar no Supabase
SELECT COUNT(*) FROM group_members
WHERE status = 'active' AND expires_at < NOW() - INTERVAL '1 day';
-- Deve retornar 0
```

### ApÃ³s 24 horas:
- Verificar se novos vencimentos estÃ£o sendo processados
- Confirmar que lembretes estÃ£o sendo enviados
- Validar que remoÃ§Ãµes estÃ£o acontecendo

---

## ğŸ“‹ CHECKLIST COMPLETO

- [ ] `CRON_SECRET` configurado na Vercel
- [ ] `ADMIN_SECRET` configurado na Vercel
- [ ] Redeploy feito
- [ ] Limpeza inicial executada (29 usuÃ¡rios)
- [ ] Cron job configurado no cron-job.org
- [ ] Bot Ã© administrador do grupo
- [ ] Bot tem permissÃ£o "Banir usuÃ¡rios"
- [ ] Primeiro ciclo de 30 min completado
- [ ] ValidaÃ§Ã£o SQL retorna 0

---

## ğŸ¯ RESULTADO ESPERADO

**Antes:**
- âŒ 29 usuÃ¡rios expirados no grupo
- âŒ Sistema nÃ£o removia automaticamente
- âŒ Sem lembretes automÃ¡ticos

**Depois:**
- âœ… Grupo limpo (apenas pagantes ativos)
- âœ… RemoÃ§Ã£o automÃ¡tica a cada 30 min
- âœ… Lembretes 3 dias antes + urgente
- âœ… QR Code gerado automaticamente
- âœ… RenovaÃ§Ãµes processadas automaticamente

---

## ğŸ“ COMANDOS ÃšTEIS

### Testar endpoint de limpeza:
```bash
curl -X POST https://seu-projeto.vercel.app/api/jobs/cleanup-expired \
  -H "x-admin-secret: SEU_ADMIN_SECRET"
```

### Testar endpoint de cron (nÃ£o remove, sÃ³ executa ciclo):
```bash
curl -X POST https://seu-projeto.vercel.app/api/jobs/expire-members \
  -H "x-cron-secret: SEU_CRON_SECRET"
```

### Ver logs na Vercel:
```bash
vercel logs --follow
# Ou acesse: https://vercel.com/seu-projeto/logs
```

---

## ğŸ”¥ EXECUTAR AGORA

1. Configure secrets na Vercel
2. Redeploy
3. Execute limpeza inicial
4. Configure cron job
5. Aguarde 30 minutos e valide

**TUDO PRONTO! Sistema 100% funcional.**
