## üöÄ COMO EXECUTAR A LIMPEZA DOS 29 USU√ÅRIOS

### üìã O QUE √â ESTE COMANDO?

```bash
curl -X POST https://api-pix-telegran.vercel.app/api/jobs/cleanup-expired \
  -H "x-admin-secret: SEU_ADMIN_SECRET"
```

**Explica√ß√£o:**
- `curl` = Ferramenta para fazer requisi√ß√µes HTTP
- `-X POST` = Tipo de requisi√ß√£o (POST)
- URL = Endpoint que vai processar os 29 usu√°rios expirados
- `-H "x-admin-secret: ..."` = Header de seguran√ßa (senha de admin)

---

## ‚öôÔ∏è PASSO A PASSO COMPLETO

### 1Ô∏è‚É£ **GERAR O ADMIN_SECRET**

Abra PowerShell e execute:
```powershell
[Convert]::ToBase64String((1..32 | ForEach-Object { Get-Random -Maximum 256 }))
```

**Exemplo de resultado:**
```
wK8xP2mR5tL9jQ6vN3bH4yF7cD1sA0zX
```

**‚ö†Ô∏è COPIE e SALVE este c√≥digo!**

---

### 2Ô∏è‚É£ **CONFIGURAR NA VERCEL**

1. Acesse: https://vercel.com/nomade-pj/api-pix-telegran/settings/environment-variables

2. Clique em **"Add New"**

3. Preencha:
   ```
   Name: ADMIN_SECRET
   Value: wK8xP2mR5tL9jQ6vN3bH4yF7cD1sA0zX  (cole o seu)
   ```

4. Selecione: **Production, Preview, Development**

5. Clique em **"Save"**

6. **IMPORTANTE:** Clique em **"Redeploy"** no topo da p√°gina

---

### 3Ô∏è‚É£ **AGUARDAR DEPLOY**

Aguarde 1-2 minutos at√© o deploy terminar.

Verifique em: https://vercel.com/nomade-pj/api-pix-telegran/deployments

Quando aparecer ‚úÖ **"Ready"**, pode continuar.

---

### 4Ô∏è‚É£ **EXECUTAR LIMPEZA**

#### **Op√ß√£o A: PowerShell (Windows)**

Abra PowerShell e execute:
```powershell
$headers = @{
    "x-admin-secret" = "wK8xP2mR5tL9jQ6vN3bH4yF7cD1sA0zX"
}

Invoke-WebRequest -Uri "https://api-pix-telegran.vercel.app/api/jobs/cleanup-expired" -Method POST -Headers $headers
```

**‚ö†Ô∏è SUBSTITUA `wK8xP2mR5tL9jQ6vN3bH4yF7cD1sA0zX` pelo seu ADMIN_SECRET!**

---

#### **Op√ß√£o B: Navegador (Mais F√°cil)**

1. Instale a extens√£o **"ModHeader"** ou **"Requestly"**
   - Chrome/Edge: https://chrome.google.com/webstore
   - Procure por "ModHeader"

2. Configure header:
   ```
   Name: x-admin-secret
   Value: wK8xP2mR5tL9jQ6vN3bH4yF7cD1sA0zX  (seu secret)
   ```

3. Abra no navegador:
   ```
   https://api-pix-telegran.vercel.app/api/jobs/cleanup-expired
   ```

---

#### **Op√ß√£o C: cURL (Git Bash / Terminal)**

Se tiver Git Bash instalado:
```bash
curl -X POST https://api-pix-telegran.vercel.app/api/jobs/cleanup-expired \
  -H "x-admin-secret: wK8xP2mR5tL9jQ6vN3bH4yF7cD1sA0zX"
```

---

### 5Ô∏è‚É£ **RESULTADO ESPERADO**

Se tudo der certo, voc√™ ver√°:

```json
{
  "success": true,
  "timestamp": "2026-01-09T...",
  "duration_ms": 45820,
  "summary": {
    "total_analyzed": 29,
    "removed_from_group": 29,
    "kept_pending_payment": 0,
    "kept_already_renewed": 0,
    "errors": 0
  },
  "message": "Processados 29 membros. 29 removidos."
}
```

**Isso significa:**
- ‚úÖ 29 usu√°rios foram removidos do grupo Telegram
- ‚úÖ 29 usu√°rios marcados como expirados no banco
- ‚úÖ 29 QR Codes de renova√ß√£o enviados via Telegram

---

### 6Ô∏è‚É£ **VALIDAR NO BANCO**

Acesse Supabase e execute:
```sql
SELECT COUNT(*) FROM group_members
WHERE status = 'active' AND expires_at < NOW() - INTERVAL '1 day';
```

**Deve retornar: 0** ‚úÖ

---

## ‚ö†Ô∏è POSS√çVEIS ERROS

### Erro 401 - Unauthorized
```json
{"error": "Unauthorized"}
```
**Solu√ß√£o:** ADMIN_SECRET est√° errado. Verifique se:
- Configurou na Vercel
- Fez Redeploy
- Est√° usando o mesmo valor no comando

### Erro 500 - Internal Server Error
**Solu√ß√£o:** 
- Verifique logs na Vercel: https://vercel.com/nomade-pj/api-pix-telegran/logs
- Veja se bot tem permiss√µes de administrador no grupo

### Timeout ou demora
**Normal!** Processar 29 usu√°rios pode levar 1-3 minutos.
Aguarde sem interromper.

---

## üéØ COMANDO PRONTO (COPIE E COLE)

### PowerShell (RECOMENDADO):
```powershell
# 1. PRIMEIRO: Substitua XXXX pelo seu ADMIN_SECRET
$secret = "XXXX_COLE_SEU_ADMIN_SECRET_AQUI_XXXX"

# 2. DEPOIS: Execute este comando
$headers = @{ "x-admin-secret" = $secret }
Invoke-WebRequest -Uri "https://api-pix-telegran.vercel.app/api/jobs/cleanup-expired" -Method POST -Headers $headers | Select-Object -ExpandProperty Content
```

---

## ‚úÖ CHECKLIST

- [ ] Gerei ADMIN_SECRET no PowerShell
- [ ] Configurei ADMIN_SECRET na Vercel
- [ ] Fiz Redeploy na Vercel
- [ ] Aguardei deploy terminar (status: Ready)
- [ ] Executei comando com meu ADMIN_SECRET
- [ ] Recebi resposta de sucesso (29 removidos)
- [ ] Validei no banco (0 usu√°rios expirados ativos)

---

**PRONTO! Copie o comando PowerShell acima e execute!** üöÄ
