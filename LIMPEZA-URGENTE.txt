## ğŸš¨ LIMPEZA URGENTE - 29 USUÃRIOS EXPIRADOS

### ğŸ“Š SITUAÃ‡ÃƒO ATUAL

Foram encontrados **29 usuÃ¡rios** com assinatura expirada que ainda estÃ£o marcados como "active" no banco:

| Mais Antigo | Mais Recente | MÃ©dia |
|-------------|--------------|-------|
| 8.6 dias | 2.2 dias | 6.5 dias |

**Nenhum deles tem pagamento pendente** - todos podem ser removidos imediatamente.

---

## âš¡ EXECUTAR LIMPEZA AGORA

### 1ï¸âƒ£ Configure a VariÃ¡vel (se ainda nÃ£o configurou)

Na Vercel, adicione:
```
ADMIN_SECRET = [sua_senha_forte_aqui]
```

Gere com:
```bash
# Windows PowerShell
[Convert]::ToBase64String((1..32 | ForEach-Object { Get-Random -Maximum 256 }))
```

### 2ï¸âƒ£ FaÃ§a Redeploy

Clique em **"Redeploy"** na Vercel para atualizar o cÃ³digo.

### 3ï¸âƒ£ Execute a Limpeza

```bash
curl -X POST \
  https://seu-projeto.vercel.app/api/jobs/cleanup-expired \
  -H "x-admin-secret: SEU_ADMIN_SECRET"
```

---

## ğŸ“‹ O QUE VAI ACONTECER

Para **CADA um dos 29 usuÃ¡rios**, o sistema vai:

1. âœ… **Verificar** se hÃ¡ pagamento pendente (dupla verificaÃ§Ã£o)
2. âŒ **Remover do grupo** Telegram
3. ğŸ’¾ **Marcar como expirado** no banco (`status = 'expired'`)
4. ğŸ“² **Enviar QR Code** de renovaÃ§Ã£o via Telegram
5. ğŸ”— **Enviar link** do grupo junto

**Exemplo da mensagem que cada usuÃ¡rio vai receber:**

```
ğŸ”„ RENOVAÃ‡ÃƒO DE ASSINATURA

âŒ Sua assinatura expirou hÃ¡ 8 dias e vocÃª foi removido do grupo.

ğŸ‘¥ Grupo: Privadinho da Val ğŸ›ğŸ”
ğŸ’° Valor: R$ 59.90
ğŸ“… DuraÃ§Ã£o: 30 dias

ğŸ”‘ Chave PIX: [chave]
ğŸ“‹ CÃ³pia & Cola: [payload]
â° VÃLIDO ATÃ‰: [horÃ¡rio]

ğŸ“¸ ApÃ³s pagar, envie o comprovante.
ApÃ³s aprovaÃ§Ã£o, vocÃª serÃ¡ adicionado automaticamente!

ğŸ”— Link do grupo: [link]
```

---

## ğŸ“Š RESPOSTA ESPERADA

```json
{
  "success": true,
  "summary": {
    "total_analyzed": 29,
    "removed_from_group": 29,
    "kept_pending_payment": 0,
    "kept_already_renewed": 0,
    "errors": 0
  },
  "message": "Processados 29 membros. 29 removidos."
}
```

---

## âœ… APÃ“S A LIMPEZA

1. **Configure o cron job** (se ainda nÃ£o configurou):
   - URL: `https://seu-projeto.vercel.app/api/jobs/expire-members`
   - FrequÃªncia: A cada 30 minutos
   - Header: `x-cron-secret: SEU_CRON_SECRET`

2. **Valide no banco**:
```sql
SELECT COUNT(*) FROM group_members
WHERE status = 'active' AND expires_at < NOW() - INTERVAL '1 day';
-- Deve retornar 0
```

3. **Delete este endpoint** (opcional, apÃ³s limpeza):
   - Remova `api/jobs/cleanup-expired.js`
   - Remova rota do `vercel.json`
   - Endpoint sÃ³ Ã© necessÃ¡rio uma vez

---

## âš ï¸ IMPORTANTE

- âœ… O bot precisa ser **administrador** do grupo
- âœ… PermissÃ£o "Banir usuÃ¡rios" deve estar ativa
- âœ… UsuÃ¡rios que pagaram continuam no grupo
- âœ… VerificaÃ§Ã£o dupla previne remover quem estÃ¡ pagando

---

## ğŸ¯ PRÃ“XIMO PASSO

**Execute o comando acima AGORA** para limpar os 29 usuÃ¡rios acumulados.

ApÃ³s isso, o cron job manterÃ¡ tudo funcionando automaticamente.
